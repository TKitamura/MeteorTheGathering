<head>
  <title>Meteor: The Gathering</title>
  <script src="jquery-ui-1.8.20.custom.min.js"></script>
  <script>
    (function ($) {
     $.fn.liveDraggable = function (opts) {
      this.live("mouseover", function() {
        if (!$(this).data("init")) {
          $(this).data("init", true).draggable(opts);
        }
      });
      return $();
     };
    }(jQuery));

    $(function () {
      var prevDraggedId = '';
      var prevDraggedTime = 0;

      $('#mat .card-container').liveDraggable({
        distance: 3,
        stop: function (event, ui) {
          $(this).find('.card').trigger('elevate').trigger('dragged');
          prevDraggedId = '';
        },
        drag: function (event, ui) {
          var now = new Date().getTime();
          var $card;
          
          if (this.id != prevDraggedId) {
            $card = $(this).find('.card');
            $card.trigger('elevate');
            prevDraggedId = this.id;
          }

          if (now - prevDraggedTime > 250) {
            if (!$card) {
              $card = $(this).find('.card');
            }
            $card.trigger('dragged');
            prevDraggedTime = now;
          }
        }
      });
      
      $('body').on('mouseup', '#mat .card', function () {
        if (prevDraggedId != '') {
          return;
        }
        $(this).trigger('elevate').trigger('menu');
      });
    });
  </script>
</head>

<body>
  {{> game }}
  {{> editor }}
</body>
